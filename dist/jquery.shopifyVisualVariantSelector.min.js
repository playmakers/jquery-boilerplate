/*
 *  jquery-shopifyVisualVariantSelector - v1.0.0
 *  Autogenerate nice visual variant selectors for shopify shops
 *  http://www.playmakers-football.de
 *
 *  Made by Tobias Bielohlawek
 *  Under MIT License
 */
!function(a){"use strict";function b(b,e){this.element=b,this.settings=a.extend({},d,e),this._defaults=d,this._name=c,this.variants={},this.defaultVariant=null,this.images=[],this.options=[],this["const"]={undefined:"undefined",selected:"selected",soldout:"soldout",unavailable:"unavailable",over:"over",keySeparator:"-",undefinedVariant:{id:"undefined"}},this.init()}var c="shopifyVisualVariantSelector",d={options:[null,null,null],hideSingleOptionsFromLevel:0,resolveAvailabilityConflict:!0,selectSoldOut:!1};a.extend(b.prototype,{init:function(){var b=this,c=a(this.element),d=this.settings.optionGroupNames||c.data("optionGroupNames")||[];a.each(d,function(a,c){b.addOption(c)}),c.find("option").each(function(c,d){var e;(e=a(d).data("variant"))&&b.addVariant(e)}),a("<option>").text(b["const"].undefined).appendTo(c)},addOption:function(b){var c=this,d=a(this.element),e=c.options.length,f=a("<div>"),g=a("<div>").addClass("option"+c.norm(b)).append(a("<span>").text(b)).append(f).insertBefore(d);c.options[e]={buttons:{},all:f},this.settings.hideSingleOptionsFromLevel&&e+1>=this.settings.hideSingleOptionsFromLevel&&g.hide()},addVariant:function(b){var c=this,d=function(a){a&&!c.images[a]&&(c.images[a]=new Image,c.images[a].src=a)},e=a.map(b.options,this.norm).join(this["const"].keySeparator);a.extend(b,{onSale:null!==b.compare_at_price&&b.price<b.compare_at_price,soldOut:b.inventory_quantity<1&&b.available,unavailable:b.inventory_quantity<1&&!b.available}),this.variants[e]||(this.variants[e]=b,d(b.image),this.renderOptionButtons(b.options),this.defaultVariant&&this.defaultVariant.available||(this.defaultVariant=b,this.selectVariant(this.defaultVariant)))},selectVariant:function(b){var c=this;a.each(b.options,function(a,b){var d=c.norm(b);c.options[a].buttons[d].find("input").click()})},optionKey:function(a){return"group"+a},renderOptionButtons:function(b){var c=this;a.each(b,function(a,b){var d=c.norm(b),e=c.options[a];if(!e.buttons[d]){var f=c.renderButton(a,b);e.buttons[d]=f.appendTo(e.all),e.all.find("label").length>1&&e.all.parent().show()}})},norm:function(a){return a.replace(/[ .\/]/g,"").replace(/ß/g,"ss").replace(/ä/g,"ae").replace(/ö/g,"oe").replace(/ü/g,"ue")},currentVariantKey:function(){var b=this;return a.map(this.options,function(c){var d=c.all.find("."+b["const"].over)[0]||c.all.find("."+b["const"].selected)[0];return a(d).find("input").val()}).join(b["const"].keySeparator)},updateSelection:function(){var b=a(this.element),c=this.currentVariantKey(),d=this.variants[c]||this["const"].undefinedVariant;b.val(d.id),this.setAvailabilites(),b.trigger("variantChange",d)},setAvailabilites:function(){var b=this,c=function(b){return a.map(b,function(a){return a})},d=function(c,d,e){var f=[];return a.each(d,function(a,b){b.trigger("availability",!1).trigger("soldout",!0)}),f=a.grep(e,function(a){var e=b.norm(a.options[c]);return a.available&&d[e].trigger("availability",!0),a.soldOut||d[e].trigger("soldout",!1),d[e].hasClass(b["const"].selected)}),b.settings.resolveAvailabilityConflict&&a.each(d,function(a,b){b.trigger("resolveAvailabilityConflict")}),f},e=c(this.variants);a.each(b.options,function(a,b){e=d(a,b.buttons,e)})},renderButton:function(b,c){var d=this,e=function(a,b){return a.addClass(b).siblings().removeClass(b).end()},f=d.optionKey(b),g=d.norm(c),h=a("<input>").attr("type","radio").attr("name",f).attr("value",g).on("click",function(b){e(a(this).parent(),d["const"].selected),d.updateSelection(),b.stopPropagation()});return a("<label>").addClass("optionValue"+g).attr("title",f+": "+c).append(h,a("<span>").text(c)).on("mouseover",function(){e(a(this),d["const"].over),d.updateSelection()}).on("mouseout",function(){a(this).removeClass(d["const"].over),d.updateSelection()}).on("soldout",function(b,c){a(this).toggleClass(d["const"].soldout,c).find("input:radio").attr("disabled",!d.settings.selectSoldOut&&c)}).on("availability",function(b,c){a(this).toggleClass(d["const"].unavailable,!c).find("input:radio").attr("disabled",!c)}).on("resolveAvailabilityConflict",function(){a(this).filter("."+d["const"].selected+"."+d["const"].unavailable).each(function(){a(this).siblings().not("."+d["const"].unavailable).first().find("input").click()})})}}),a.fn[c]=function(d){return this.each(function(){a.data(this,"plugin_"+c)||a.data(this,"plugin_"+c,new b(this,d))})}}(jQuery,window,document);